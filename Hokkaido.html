<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 åŒ—æµ·é“è‡ªé§• (Final)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #0056b3;
            --accent: #d32f2f;
            --bg: #f0f2f5;
            --card-bg: #fff;
            --text: #333;
        }
        
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* === Header === */
        header {
            background: var(--primary); color: white; padding: 12px 16px; 
            position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        h1 { margin: 0; font-size: 1.1rem; font-weight: bold; }
        
        /* ç›´æ¥é¡¯ç¤ºåŒ¯ç‡ */
        .live-rate {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            display: flex; align-items: center; gap: 5px;
        }

        /* === Map Area === */
        #map-container { height: 35vh; width: 100%; position: relative; border-bottom: 1px solid #ddd; }
        #map { width: 100%; height: 100%; background: #e5e3df; }
        .gps-btn {
            position: absolute; bottom: 20px; right: 20px; width: 45px; height: 45px;
            background: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; z-index: 900; font-size: 22px; cursor: pointer;
        }

        /* === Tabs === */
        .tabs {
            display: flex; overflow-x: auto; background: #fff; padding: 10px 0;
            scrollbar-width: none; border-bottom: 1px solid #eee;
        }
        .tab {
            flex: 0 0 auto; margin: 0 5px; padding: 8px 16px; border-radius: 20px;
            background: #f5f5f5; color: #666; font-size: 14px; font-weight: bold; transition: 0.2s; cursor: pointer;
        }
        .tab:first-child { margin-left: 10px; }
        .tab.active { background: var(--primary); color: #FFF; box-shadow: 0 2px 5px rgba(0,86,179,0.3); }

        /* === List View === */
        .list-container { padding: 15px; }
        
        .weather-bar {
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            color: white; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 0.95rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .travel-line {
            display: flex; align-items: center; margin-left: 17px; height: 30px;
            border-left: 2px dashed #ccc; padding-left: 20px; color: #666; font-size: 0.8rem; font-weight: bold;
        }

        .card {
            background: var(--card-bg); border-radius: 10px; padding: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 0;
            border: 1px solid #eee; cursor: pointer; display: flex; gap: 12px;
        }
        .card:active { background: #f9f9f9; }

        .num-badge {
            width: 28px; height: 28px; background: var(--primary); color: white;
            border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold; font-size: 14px;
            flex-shrink: 0; margin-top: 2px;
        }

        .card-content { flex: 1; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .card-time { font-size: 0.9rem; font-weight: bold; color: #555; background: #eee; padding: 2px 6px; border-radius: 4px; }
        .card-title { font-size: 1.1rem; font-weight: bold; color: #222; margin-bottom: 6px; }
        
        /* Info Grid */
        .info-grid {
            display: grid; grid-template-columns: 1fr; gap: 4px; font-size: 0.85rem; color: #555;
            background: #f9f9f9; padding: 8px; border-radius: 6px; margin-bottom: 8px;
        }
        .info-item { display: flex; gap: 6px; }
        .icon { width: 16px; text-align: center; }
        .highlight { color: #d32f2f; font-weight: bold; }

        .card-footer { display: flex; justify-content: space-between; align-items: center; }
        .mapcode-box {
            font-family: monospace; font-size: 0.9rem; color: var(--primary); font-weight: bold;
            background: #e3f2fd; padding: 4px 8px; border-radius: 4px; border: 1px dashed var(--primary);
        }
        .price-text { font-weight: bold; color: #2e7d32; font-size: 0.95rem; }

        /* Map Markers */
        .map-marker-icon {
            background: var(--primary); color: white; width: 30px; height: 30px;
            border-radius: 50%; text-align: center; line-height: 26px;
            font-weight: bold; font-size: 14px; border: 2px solid white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        /* Popup Styling */
        .leaflet-popup-content-wrapper { padding: 0; border-radius: 10px; overflow: hidden; }
        .leaflet-popup-content { margin: 0; width: 260px !important; }
        .pop-body { padding: 15px; text-align: center; }
        .pop-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .pop-btn {
            display: block; background: #4285F4; color: white; text-decoration: none;
            padding: 10px; border-radius: 50px; font-weight: bold; margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .pop-btn:active { transform: scale(0.98); }

        /* Toast */
        #toast {
            visibility: hidden; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.85); color: white; padding: 12px 24px; border-radius: 50px;
            font-weight: bold; font-size: 14px; z-index: 3000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.3s 2s; }
        @keyframes fadein { from {bottom: 10px; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 10px; opacity: 0;} }
    </style>
</head>
<body>

<header>
    <h1>2026 åŒ—æµ·é“è‡ªé§•</h1>
    <div class="live-rate" id="header-rate"></div>
</header>

<div id="map-container">
    <div id="map"></div>
    <div class="gps-btn" onclick="locateMe()">ğŸ“</div>
</div>

<div class="tabs" id="tabs-container"></div>

<div class="list-container">
    <div id="weather-bar" class="weather-bar"></div>
    <div id="itinerary-list"></div>
</div>

<div id="toast">å·²è¤‡è£½ MapCode</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const RATE = 0.053;
    // è¨­ç½®é ‚éƒ¨åŒ¯ç‡é¡¯ç¤º (100 JPY = XX HKD)
    document.getElementById('header-rate').innerHTML = `ğŸ‡¯ğŸ‡µ 100å†† â‰ˆ ğŸ‡­ğŸ‡° $${(100 * RATE).toFixed(1)}`;

    // === è¡Œç¨‹è³‡æ–™ ===
    const data = [
        {
            day: "Day 1", date: "1æœˆ31æ—¥ (å…­) åå¤å±‹",
            weather: "â˜ï¸ 2Â°C ~ 9Â°C | å»ºè­°: è¼•ç¾½çµ¨",
            items: [
                { t: "13:00", n: "é¦™æ¸¯æ©Ÿå ´ / æŠµé”åå¤å±‹", note: "13:00åˆ°æ©Ÿå ´ï¼Œ20:05åˆ°åå¤å±‹ã€‚", c: "---", p: 0, lat: 34.8584, lng: 136.8053 },
                { 
                    t: "21:30", n: "æ–°æ™‚ä»£ ä¼ä¸²", travel: "ğŸš† 45åˆ†é˜", 
                    note: "å¸¸æ»‘é§…å‰åº—ã€‚", c: "---", p: 2000, lat: 34.8906, lng: 136.8344,
                    hours: "17:00 - 24:00", rec: "å¿…é£Ÿï¼šç‚¸é›çš®ä¸²ã€ç”Ÿå•¤"
                },
                { t: "23:00", n: "å¸¸æ»‘/æ©Ÿå ´é…’åº—", travel: "ğŸš¶ 10åˆ†é˜", note: "æ˜æ—©04:00èµ·èº«ã€‚", c: "---", p: 0, lat: 34.8616, lng: 136.8115 }
            ]
        },
        {
            day: "Day 2", date: "2æœˆ1æ—¥ (æ—¥) æœ­å¹Œâ”æ´çˆº",
            weather: "ğŸŒ¨ï¸ -6Â°C ~ -1Â°C | å»ºè­°: é˜²æ»‘é›ªé´",
            items: [
                { t: "05:00", n: "NGO âœˆï¸ CTS", note: "07:05èµ·é£›ã€‚", c: "---", p: 0, lat: 42.7874, lng: 141.6814 },
                { t: "10:00", n: "æ–°åƒæ­²å–è»Š", travel: "ğŸš¶ åˆ°é”", note: "å‡ºé—œå–è»Šï¼Œæª¢æŸ¥é›ªèƒã€‚", c: "113 744 720*63", p: "ç§Ÿè»Š", lat: 42.7874, lng: 141.6814 },
                { 
                    t: "11:30", n: "äºŒæ¢å¸‚å ´", travel: "ğŸš— 60åˆ†é˜", 
                    note: "æµ·é®®ä¸¼åˆé¤ã€‚", c: "9 493 643*12", p: 3000, lat: 43.0573, lng: 141.3585,
                    hours: "07:00 - 17:00", rec: "æ¨ä»‹ï¼šå¤§ç£¯ã€èŒ¶å±‹"
                },
                { 
                    t: "13:00", n: "Curry Ya! CONG", travel: "ğŸš— 10åˆ†é˜", 
                    note: "æ¹¯å’–å–± (å‚™é¸)ã€‚", c: "9 432 642*55", p: 1500, lat: 43.0503, lng: 141.3506,
                    hours: "11:30 - 15:00", rec: "å¿…é£Ÿï¼šæ¼¢å ¡æ‰’æ¹¯å’–å–±"
                },
                { 
                    t: "14:00", n: "ç™½è‰²æˆ€äººå…¬åœ’", travel: "ğŸš— 25åˆ†é˜", 
                    note: "15:00 é›¢é–‹æœ­å¹Œã€‚", c: "9 602 326*11", p: 800, lat: 43.0886, lng: 141.2704,
                    hours: "10:00 - 18:00", rec: "å¿…è²·ï¼šé™å®šç‰ˆç™½ä¹‹æˆ€äºº"
                },
                { 
                    t: "17:00", n: "Yutorelo Toyako", travel: "ğŸš— 1å°æ™‚50åˆ†", 
                    note: "æº«æ³‰é…’åº— (æ™šé¤18:00)ã€‚", c: "321 519 548*60", p: "å·²è¨‚", lat: 42.5654, lng: 140.8202,
                    rec: "å¿…åšï¼šæµ¸æº«æ³‰ã€æ‡·çŸ³æ™šé¤"
                }
            ]
        },
        {
            day: "Day 3", date: "2æœˆ2æ—¥ (ä¸€) æ´çˆºâ”å‡½é¤¨",
            weather: "ğŸŒ¬ï¸ -5Â°C ~ 0Â°C | å»ºè­°: é˜²é¢¨å¤–å¥—",
            items: [
                { t: "10:15", n: "ç­’å€‰å±•æœ›å°", travel: "ğŸš— 15åˆ†é˜", note: "æ´çˆºæ¹–å…¨æ™¯ã€‚", c: "321 433 319*63", p: 0, lat: 42.6133, lng: 140.7877, rec: "å¿…è²·ï¼šç‰§å®¶Boccaå¸ƒç”¸" },
                { t: "11:00", n: "é“ã®é§… Aputa", travel: "ğŸš— 20åˆ†é˜", note: "å¿…è²·æµ·è†½é£¯ã€‚", c: "321 346 397*52", p: 2500, lat: 42.5357, lng: 140.7644, rec: "å¿…é£Ÿï¼šæ•´æ¿æµ·è†½" },
                { t: "12:00", n: "ä»™å ‚åºµ (åˆé¤)", travel: "ğŸš— 10åˆ†é˜", note: "15:00 é›¢é–‹æ´çˆºã€‚", c: "321 518 534*88", p: 1500, lat: 42.5539, lng: 140.8173 },
                { t: "19:00", n: "å‡½é¤¨å±±å¤œæ™¯", travel: "ğŸš— 2å°æ™‚30åˆ†", note: "ç™¾è¬å¤œæ™¯ (æ¥µå†·)ã€‚", c: "86 041 054*41", p: 1800, lat: 41.7613, lng: 140.7144, hours: "10:00 - 21:00" }
            ]
        },
        {
            day: "Day 4", date: "2æœˆ3æ—¥ (äºŒ) å‡½é¤¨â”å°æ¨½",
            weather: "â„ï¸ -6Â°C ~ -2Â°C | å»ºè­°: è²¼æš–åŒ…",
            items: [
                { t: "06:00", n: "å‡½é¤¨æœå¸‚", note: "é‡£çƒè³Šé«”é©—ã€‚", c: "86 072 344*41", p: 2000, lat: 41.7725, lng: 140.7250, hours: "06:00 - 14:00", rec: "å¿…åšï¼šé‡£æ´»çƒè³Šåˆºèº«" },
                { t: "10:00", n: "å°ä¸‘æ¼¢å ¡", travel: "ğŸš— 5åˆ†é˜", note: "ä¸­è¯é›è…¿å ¡ã€‚", c: "86 041 645*88", p: 800, lat: 41.7681, lng: 140.7186, rec: "å¿…é£Ÿï¼šNo.1 é›è…¿å ¡" },
                { t: "13:00", n: "äº”ç¨œéƒ­å¡”", travel: "ğŸš— 20åˆ†é˜", note: "æ˜Ÿå½¢å…¬åœ’ã€‚", c: "86 165 057*12", p: 1000, lat: 41.7955, lng: 140.7551 },
                { t: "17:00", n: "é•·é€”ç§»å‹• (å…«é›²PA)", travel: "ğŸš— 1å°æ™‚30åˆ†", note: "ä¸­é€”ä¼‘æ¯ç«™ã€‚", c: "468 052 708*85", p: 0, lat: 42.2530, lng: 140.2769 },
                { t: "23:00", n: "å°æ¨½é…’åº—", travel: "ğŸš— 2å°æ™‚45åˆ†", note: "è‡ªåŠ© Check-inã€‚", c: "---", p: "å·²è¨‚", lat: 43.1995, lng: 141.0016 }
            ]
        },
        {
            day: "Day 5", date: "2æœˆ4æ—¥ (ä¸‰) å°æ¨½â”æ—­å·",
            weather: "â˜ƒï¸ -12Â°C ~ -4Â°C | å»ºè­°: å…©å±¤è¤²å­",
            items: [
                { t: "09:30", n: "å°æ¨½å ºç”ºé€š", note: "LeTAOã€å…«éŸ³ç›’ã€‚", c: "493 660 635*41", p: 1500, lat: 43.1916, lng: 141.0076, hours: "09:00 - 18:00", rec: "å¿…é£Ÿï¼šé›™å±¤èŠå£«è›‹ç³•" },
                { t: "15:00", n: "æœ­å¹Œé›ªç¥­ (å¤§é€š)", travel: "ğŸš— 45åˆ†é˜", note: "é›ªé›•å±•ã€‚", c: "9 522 448*88", p: 0, lat: 43.0601, lng: 141.3533, rec: "å¿…çœ‹ï¼šå¤§å‹é›ªé›•" },
                { t: "19:30", n: "æˆå‰æ€æ±— å¤§é»‘å±‹", travel: "ğŸš— 2å°æ™‚", note: "æ—­å·ç‡’è‚‰ã€‚", c: "79 342 546*36", p: 4000, lat: 43.7651, lng: 142.3619, hours: "17:00 - 22:30", rec: "å¿…é£Ÿï¼šç”Ÿç¾Šè‚‰ç‡’è‚‰" }
            ]
        },
        {
            day: "Day 6", date: "2æœˆ5æ—¥ (å››) æ—­å·ãƒ»ç¾ç‘›",
            weather: "ğŸ¥¶ -15Â°C ~ -6Â°C | å»ºè­°: æœ€å¼·ä¿æš–",
            items: [
                { t: "09:00", n: "è–èª•æ¨¹ä¹‹æœ¨", travel: "ğŸš— 40åˆ†é˜", note: "è·¯é‚Šæ‹ç…§ (ç¦å…¥è¾²ç”°)ã€‚", c: "349 788 146*81", p: 0, lat: 43.5599, lng: 142.4820 },
                { t: "10:30", n: "æ—­å±±å‹•ç‰©åœ’", travel: "ğŸš— 30åˆ†é˜", note: "ä¼éµæ•£æ­¥ã€‚", c: "79 358 805*17", p: 1000, lat: 43.7687, lng: 142.4795, hours: "10:30 - 15:30", rec: "å¿…çœ‹ï¼šä¼éµæ•£æ­¥ (11:00)" },
                { t: "16:00", n: "ç™½é¬šç€‘å¸ƒ", travel: "ğŸš— 50åˆ†é˜", note: "æ¸…æ± é™„è¿‘ã€‚", c: "796 182 604*25", p: 0, lat: 43.4754, lng: 142.6416 },
                { t: "17:00", n: "ç™½é‡‘æ¸…æ± ", travel: "ğŸš— 5åˆ†é˜", note: "å¤œé–“é»ç‡ˆã€‚", c: "349 568 888*00", p: 500, lat: 43.4934, lng: 142.6139, rec: "å¿…çœ‹ï¼šå†¬å­£é™å®šé»ç‡ˆ" }
            ]
        },
        {
            day: "Day 7", date: "2æœˆ6æ—¥ (äº”) å¯Œè‰¯é‡",
            weather: "ğŸŒ¨ï¸ -12Â°C ~ -5Â°C | å»ºè­°: é˜²æ»‘å†°çˆª",
            items: [
                { t: "09:30", n: "æ£®æ—ç²¾éˆéœ²å°", travel: "ğŸš— 40åˆ†é˜", note: "å°æœ¨å±‹å•†åº—ã€‚", c: "919 552 416*41", p: 0, lat: 43.3243, lng: 142.3551, hours: "12:00 - 20:45" },
                { t: "12:00", n: "å”¯æˆ‘ç¨å°Š", travel: "ğŸš— 10åˆ†é˜", note: "é»‘å’–å–±ã€‚", c: "349 032 073*41", p: 1200, lat: 43.3446, lng: 142.3879, hours: "11:00 - 21:00", rec: "å¿…é£Ÿï¼šè‡ªå®¶è£½é¦™è…¸å’–å–±" },
                { t: "18:00", n: "æœ­å¹Œè³¼ç‰©", travel: "ğŸš— 2å°æ™‚", note: "æœ€å¾Œè¡åˆºã€‚", c: "9 522 448*88", p: 0, lat: 43.0601, lng: 141.3533 }
            ]
        },
        {
            day: "Day 8", date: "2æœˆ7æ—¥ (å…­) æ©Ÿå ´",
            weather: "â›… -3Â°C ~ 2Â°C | å»ºè­°: æ´‹è”¥å¼ç©¿æ­",
            items: [
                { t: "09:00", n: "æ¸…ç”°ç¨»è·ç¥ç¤¾", travel: "ğŸš— 25åˆ†é˜", note: "ç´…è‰²é³¥å±…ã€‚", c: "9 292 278*25", p: 0, lat: 42.9926, lng: 141.4468 },
                { t: "11:30", n: "ä¸‰äº•OutletåŒ—å»£å³¶", travel: "ğŸš— 20åˆ†é˜", note: "è³¼ç‰©ã€‚", c: "708 630 468*78", p: 0, lat: 42.9691, lng: 141.4627, hours: "10:00 - 20:00" },
                { t: "16:00", n: "æ–°åƒæ­²æ©Ÿå ´", travel: "ğŸš— 35åˆ†é˜", note: "é‚„è»Šå…¥æ²¹ã€‚18:25è¦åˆ°ã€‚", c: "113 745 595*55", p: 0, lat: 42.7874, lng: 141.6814 }
            ]
        },
        {
            day: "Day 9", date: "2æœˆ8æ—¥ (æ—¥) åå¤å±‹",
            weather: "â˜€ 3Â°C ~ 10Â°C | å»ºè­°: èˆ’é©ä¾¿æœ",
            items: [
                { t: "09:00", n: "å¤§é ˆè§€éŸ³", note: "åå¤å±‹è§€å…‰ã€‚", c: "---", p: 0, lat: 35.1598, lng: 136.8997 }
            ]
        }
    ];

    // === Map & Init ===
    let map = null, markers = [], userMarker = null;
    try {
        map = L.map('map').setView([43.0, 141.5], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OSM' }).addTo(map);
    } catch(e) { document.getElementById('map').innerHTML = "<div style='text-align:center;padding:20px;color:#999;'>éœ€è¦ç¶²çµ¡è¼‰å…¥åœ°åœ–</div>"; }

    // === Tabs ===
    const tabsContainer = document.getElementById('tabs-container');
    data.forEach((day, index) => {
        const t = document.createElement('div');
        t.className = `tab ${index === 0 ? 'active' : ''}`;
        t.innerText = day.day;
        t.onclick = () => renderDay(index);
        tabsContainer.appendChild(t);
    });

    // === Render ===
    function renderDay(index) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === index));
        const dayInfo = data[index];
        const list = document.getElementById('itinerary-list');
        list.innerHTML = '';
        
        // å¤©æ°£ (å«ç©¿æ­)
        document.getElementById('weather-bar').innerHTML = `<span>${dayInfo.weather.split('|')[0]}</span><span style="font-size:0.85rem;opacity:0.9">${dayInfo.weather.split('|')[1]}</span>`;

        if(map) { markers.forEach(m => map.removeLayer(m)); markers = []; }
        const bounds = [];

        dayInfo.items.forEach((item, i) => {
            const num = i + 1;

            // Map
            if(map && item.lat) {
                const icon = L.divIcon({
                    className: 'custom-icon',
                    html: `<div class="map-marker-icon">${num}</div>`,
                    iconSize: [30, 30], iconAnchor: [15, 15]
                });
                
                // POPUP BUTTON -> GOOGLE MAPS DIRECT LINK
                const popContent = `
                    <div class="pop-body">
                        <div class="pop-title">${num}. ${item.n}</div>
                        <a href="https://www.google.com/maps/dir/?api=1&destination=${item.lat},${item.lng}" target="_blank" class="pop-btn">ğŸš€ Google Maps å°èˆª</a>
                    </div>
                `;
                
                const m = L.marker([item.lat, item.lng], {icon: icon}).addTo(map).bindPopup(popContent);
                markers.push(m);
                bounds.push([item.lat, item.lng]);
            }

            // Travel Line
            if (item.travel) {
                const travelDiv = document.createElement('div');
                travelDiv.className = 'travel-line';
                travelDiv.innerHTML = `â¬‡ï¸ ${item.travel}`;
                list.appendChild(travelDiv);
            }

            // Card
            const card = document.createElement('div');
            card.className = 'card';

            let priceText = '<span class="price-text" style="color:#666">å…è²»</span>';
            if (typeof item.p === 'number' && item.p > 0) {
                const hkd = Math.round(item.p * RATE);
                priceText = `<span style="font-size:0.8rem;color:#999;text-decoration:line-through;margin-right:5px;">Â¥${item.p}</span><span class="price-text">HK$${hkd}</span>`;
            } else if (typeof item.p === 'string') {
                priceText = `<span class="price-text" style="color:#d32f2f;">${item.p}</span>`;
            }

            const mapCodeHtml = item.c !== "---" ? `<div class="mapcode-box" onclick="event.stopPropagation(); copy('${item.c}')">${item.c} â</div>` : '<div></div>';
            
            let details = '';
            if (item.hours) details += `<div class="info-item"><span class="icon">ğŸ•’</span> ç‡Ÿæ¥­: ${item.hours}</div>`;
            if (item.rec) details += `<div class="info-item"><span class="icon">â­</span> <span class="highlight">${item.rec}</span></div>`;
            if (details) details = `<div class="info-grid">${details}</div>`;

            let warnHtml = (item.note.includes('æœ€é²') || item.note.includes('å…¥æ²¹')) ? `<span style="color:red;font-weight:bold;font-size:0.8rem;background:#ffebee;padding:2px 5px;border-radius:4px;margin-right:5px;">âš ï¸ æ³¨æ„</span>` : '';

            card.innerHTML = `
                <div class="num-badge">${num}</div>
                <div class="card-content">
                    <div class="card-header"><div class="card-time">${item.t}</div></div>
                    <div class="card-title">${item.n}</div>
                    <div style="font-size:0.9rem;color:#666;margin-bottom:8px;">${warnHtml}${item.note}</div>
                    ${details}
                    <div class="card-footer">
                        ${mapCodeHtml}
                        <div>${priceText}</div>
                    </div>
                </div>
            `;
            
            card.onclick = () => {
                if(map && item.lat) {
                    map.flyTo([item.lat, item.lng], 13);
                    if(markers[i]) markers[i].openPopup();
                    window.scrollTo({top:0, behavior:'smooth'});
                }
            };
            list.appendChild(card);
        });

        if(map && bounds.length) map.fitBounds(bounds, {padding:[50,50]});
    }

    function copy(text) {
        navigator.clipboard.writeText(text).then(() => {
            const t = document.getElementById('toast');
            t.className = 'show';
            setTimeout(() => t.className = '', 2000);
        });
    }
    
    function locateMe() {
        if(!map) return;
        map.locate({setView: true, maxZoom: 14});
        map.on('locationfound', e => {
            if(userMarker) map.removeLayer(userMarker);
            userMarker = L.circleMarker(e.latlng, {radius: 8, color: '#fff', fillColor: '#007AFF', fillOpacity: 1}).addTo(map);
        });
    }

    renderDay(0);
</script>
</body>
</html>
